<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Rolling Coin Simulator (No Slip)</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #000011;
      font-family: 'Arial', sans-serif;
      overflow: hidden;
      color: white;
    }

    #controls {
      position: fixed;
      top: 10px;
      left: 10px;
      right: 10px;
      background: rgba(0,0,0,0.9);
      padding: 15px;
      border-radius: 10px;
      border: 2px solid #4444ff;
      z-index: 100;
      max-height: 60vh;
      overflow-y: auto;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    #controls.minimized {
      max-height: 50px;
      overflow: hidden;
    }

    #controls.minimized .control-content {
      display: none;
    }

    #minimizeBtn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #4444ff;
      border: none;
      color: white;
      padding: 5px 10px;
      border-radius: 3px;
      cursor: pointer;
      font-size: 12px;
    }

    @media (max-width: 768px) {
      #controls {
        top: 5px;
        left: 5px;
        right: 5px;
        padding: 10px;
        font-size: 12px;
        max-height: 50vh;
      }

      .control-group { margin: 8px 0; }
      label { font-size: 11px; margin-bottom: 3px; }
      select, input { width: 100%; padding: 6px; font-size: 12px; }
      .button { padding: 8px 12px; font-size: 11px; margin: 3px; }
    }

    .control-group { margin: 8px 0; display: flex; flex-direction: column; }
    .control-row { display: flex; gap: 15px; align-items: flex-start; }
    .control-column { flex: 1; display: flex; flex-direction: column; gap: 8px; }
    .button-row { display: flex; flex-wrap: wrap; gap: 5px; }

    label {
      display: block;
      margin-bottom: 5px;
      color: #88aaff;
      font-weight: bold;
    }

    select, input {
      width: 100%;
      max-width: 220px;
      padding: 8px;
      border-radius: 5px;
      border: 1px solid #4444ff;
      background: #001122;
      color: white;
      font-size: 14px;
    }

    .button {
      background: linear-gradient(45deg, #4444ff, #8888ff);
      border: none;
      color: white;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
      font-weight: bold;
    }

    .button:hover { background: linear-gradient(45deg, #6666ff, #aaaaff); }

    .copyright {
      position: fixed;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
      color: #6666aa;
      font-size: 12px;
      font-family: 'Arial', sans-serif;
      z-index: 100;
      background: rgba(0,0,0,0.7);
      padding: 5px 10px;
      border-radius: 5px;
    }

    .ground {
      position: fixed;
      bottom: 0;
      width: 100%;
      height: 80px;
      background: linear-gradient(0deg, rgba(20,30,60,0.9), rgba(0,0,0,0));
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div id="controls">
    <button id="minimizeBtn" onclick="toggleControls()">-</button>
    <h3>Rolling Coin Controls</h3>
    <div class="control-content">
      <div class="control-row">
        <div class="control-column">
          <div class="control-group">
            <label>Mass (m)</label>
            <input type="range" id="mass" min="0.1" max="10" step="0.1" value="1.0">
            <span id="massValue">1.0</span>
          </div>
          <div class="control-group">
            <label>Radius (R)</label>
            <input type="range" id="radius" min="20" max="150" step="1" value="60">
            <span id="radiusValue">60</span>
          </div>
        </div>
        <div class="control-column">
          <div class="control-group">
            <label>Initial Angular Momentum (L)</label>
            <input type="range" id="angMomentum" min="-400" max="400" step="1" value="120">
            <span id="angMomentumValue">120</span>
          </div>
          <div class="control-group">
            <label>Time Scale</label>
            <input type="range" id="timeScale" min="0.1" max="30" step="0.1" value="3">
            <span id="timeScaleValue">3.0</span>
          </div>
        </div>
      </div>
      <div class="button-row">
        <button class="button" onclick="resetSimulation()">Reset</button>
        <button class="button" onclick="togglePause()">Pause</button>
        <button class="button" onclick="toggleTrails()">Trails</button>
      </div>
      <div>
        <small>No-slip constraint: v = R·ω with ω = L / I and I = ½ m R². The coin’s contact point has zero velocity relative to the ground.</small>
      </div>
    </div>
  </div>

  <div class="ground"></div>
  <div class="copyright">© M.Zaiss'25 · Rolling Coin · <a href="index.html" target="_blank" style="color:#8888cc; text-decoration:none;">Planets</a></div>

  <script>
    // Canvas setup
    const canvas = document.createElement('canvas');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    document.body.appendChild(canvas);
    const ctx = canvas.getContext('2d');

    // Simulation parameters
    let paramMass = 1.0;
    let paramRadius = 60; // pixels, also used as length unit for drawing
    let paramL = 120; // angular momentum magnitude (arbitrary units)
    let paramTimeScale = 3.0;

    // State variables
    let coinX = 200; // center x (px)
    let coinY = 0;   // computed from ground - radius
    let coinAngle = 0; // orientation angle (rad)
    let omega = 0;     // angular velocity (rad/s)
    let vx = 0;        // linear velocity (px/s)

    let isPaused = false;
    let showTrails = false;

    // UI wiring
    const massEl = document.getElementById('mass');
    const radiusEl = document.getElementById('radius');
    const LEl = document.getElementById('angMomentum');
    const timeEl = document.getElementById('timeScale');

    function syncLabels() {
      document.getElementById('massValue').textContent = Number(massEl.value).toFixed(1);
      document.getElementById('radiusValue').textContent = Number(radiusEl.value).toFixed(0);
      document.getElementById('angMomentumValue').textContent = Number(LEl.value).toFixed(0);
      document.getElementById('timeScaleValue').textContent = Number(timeEl.value).toFixed(1);
    }

    // Live-apply parameter changes to maintain no-slip without requiring Reset
    function applyNoSlipParams() {
      paramMass = Number(massEl.value);
      paramRadius = Number(radiusEl.value);
      paramL = Number(LEl.value);
      const I = momentOfInertia(paramMass, paramRadius);
      omega = I > 0 ? (paramL / I) : 0; // ω = L / I
      vx = omega * paramRadius;         // v = R · ω
      // Keep the coin in contact with the ground as R changes
      coinY = canvas.height - 60 - paramRadius;
      syncLabels();
    }

    massEl.addEventListener('input', applyNoSlipParams);
    radiusEl.addEventListener('input', applyNoSlipParams);
    LEl.addEventListener('input', applyNoSlipParams);
    timeEl.addEventListener('input', () => { syncLabels(); paramTimeScale = Number(timeEl.value); });

    function toggleControls() {
      const controls = document.getElementById('controls');
      const btn = document.getElementById('minimizeBtn');
      controls.classList.toggle('minimized');
      btn.textContent = controls.classList.contains('minimized') ? '+' : '-';
    }

    function togglePause() { isPaused = !isPaused; }

    function toggleTrails() {
      showTrails = !showTrails;
      if (!showTrails) ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    function momentOfInertia(m, R) { return 0.5 * m * R * R; }

    function resetSimulation() {
      // Read UI
      paramMass = Number(massEl.value);
      paramRadius = Number(radiusEl.value);
      paramL = Number(LEl.value);
      paramTimeScale = Number(timeEl.value);
      syncLabels();

      // Place coin and compute state that satisfies no-slip with given L
      coinY = canvas.height - 60 - paramRadius; // 60px visual ground height
      coinX = Math.max(paramRadius + 20, 200);
      coinAngle = 0;

      const I = momentOfInertia(paramMass, paramRadius);
      omega = I > 0 ? (paramL / I) : 0; // ω = L / I
      vx = omega * paramRadius;         // v = R · ω (no slip)

      // Clear canvas if trails off
      if (!showTrails) ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    // Draw coin and ground
    function draw() {
      if (!showTrails) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
      }

      // Ground line
      ctx.save();
      ctx.strokeStyle = '#224488';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(0, canvas.height - 60);
      ctx.lineTo(canvas.width, canvas.height - 60);
      ctx.stroke();
      ctx.restore();

      // Coin body
      ctx.save();
      ctx.translate(coinX, coinY);
      const gradient = ctx.createRadialGradient(0, -paramRadius*0.4, paramRadius*0.2, 0, 0, paramRadius);
      gradient.addColorStop(0, 'hsl(220, 80%, 70%)');
      gradient.addColorStop(1, 'hsl(220, 80%, 30%)');
      ctx.fillStyle = gradient;
      ctx.beginPath();
      ctx.arc(0, 0, paramRadius, 0, Math.PI * 2);
      ctx.fill();

      // Rim
      ctx.strokeStyle = 'rgba(255,255,255,0.8)';
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.arc(0, 0, paramRadius, 0, Math.PI * 2);
      ctx.stroke();

      // Spokes/ticks to visualize rotation
      ctx.rotate(coinAngle);
      ctx.strokeStyle = 'rgba(255,255,255,0.7)';
      ctx.lineWidth = 2;
      const numSpokes = 12;
      for (let i = 0; i < numSpokes; i++) {
        const a = (i / numSpokes) * Math.PI * 2;
        ctx.save();
        ctx.rotate(a);
        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.lineTo(0, -paramRadius);
        ctx.stroke();
        ctx.restore();
      }

      // Contact point marker
      ctx.save();
      ctx.rotate(-coinAngle); // undo to draw at world orientation
      ctx.fillStyle = 'rgba(255,220,0,0.9)';
      ctx.beginPath();
      ctx.arc(0, paramRadius, 5, 0, Math.PI * 2);
      ctx.fill();
      ctx.restore();

      ctx.restore();

      // HUD text
      ctx.save();
      ctx.fillStyle = 'rgba(200,220,255,0.9)';
      ctx.font = '12px Arial';
      const I = momentOfInertia(paramMass, paramRadius);
      const info = `m=${paramMass.toFixed(1)}  R=${paramRadius.toFixed(0)}  I=½mR²=${I.toFixed(1)}  L=${paramL.toFixed(0)}  ω=${omega.toFixed(2)}  v=${vx.toFixed(2)}`;
      ctx.fillText(info, 12, 20);
      ctx.restore();
    }

    function update(dt) {
      if (isPaused) return;
      const dtScaled = dt * paramTimeScale;

      // Enforce no-slip at all times using current ω
      // With no torques, L is constant -> ω constant (unless user resets)
      coinX += vx * dtScaled;
      coinAngle += omega * dtScaled;

      // Wrap-around so the coin stays on screen
      const wrapLeft = -paramRadius - 5;
      const wrapRight = canvas.width + paramRadius + 5;
      if (coinX > wrapRight) coinX = wrapLeft;
      if (coinX < wrapLeft) coinX = wrapRight;
    }

    function animate() {
      const dt = 1/60; // seconds
      update(dt);
      draw();
      requestAnimationFrame(animate);
    }

    // Resize handler
    window.addEventListener('resize', () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      // Keep coin on ground
      coinY = canvas.height - 60 - paramRadius;
      if (!showTrails) ctx.clearRect(0, 0, canvas.width, canvas.height);
    });

    // Init
    syncLabels();
    resetSimulation();
    animate();
  </script>
</body>
</html>